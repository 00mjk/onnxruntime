parameters:
  DoDebugBuild: 'true'
  DoCompliance: 'false'
  BuildCommand: ''
  JobName: 'Windows_CI_Dev_x86'
  DoNugetPack:  'false'
  NuPackScript : ''
  ArtifactName: 'drop-win-x86-zip'
  DoEsrp: 'false'
  DoTestCoverage: 'false'
  BuildArch: 'x86'
  SetVcvars: 'false'
  msbuildArchitecture: 'x86'
  MsbuildArguments: '/m'
  EnvSetupScript: 'setup_env_x86.bat'
  AgentPool: 'Win-CPU'
  AgentDemands: []

jobs:
- job: ${{ parameters.JobName }}
  workspace:
    clean: all
  timeoutInMinutes: 120
  pool:
    name: ${{ parameters.AgentPool }}
    demands: ${{ parameters.AgentDemands }}
  variables:
    buildDirectory: '$(Build.BinariesDirectory)'
    BuildCommand: ${{ parameters.BuildCommand }}
    OnnxRuntimeBuildDirectory: '$(Build.BinariesDirectory)'
    PlatformTarget: x86
    RuntimeIdentifier: win-x86

  steps:
    - template: set-test-data-variables-step.yml
    - template: windows-build-tools-setup-steps.yml
      parameters:
        EnvSetupScript: ${{ parameters.EnvSetupScript }}
        buildArch: ${{ parameters.msbuildArchitecture }}
        setVcvars: ${{ parameters.SetVcvars }}
    - template: win-x86-ci-helper.yml
      parameters:
        BuildCommand: $(BuildCommand)
        DoDebugBuild: ${{ parameters.DoDebugBuild }}
        DoNugetPack : ${{ parameters.DoNugetPack }}
        DoCompliance: ${{ parameters.DoCompliance }}
        DoEsrp: ${{ parameters.DoEsrp }}
        NuPackScript: ${{ parameters.NuPackScript }}
        ArtifactName: ${{ parameters.ArtifactName }}
        DoTestCoverage: ${{ parameters.DoTestCoverage }}
        BuildArch: ${{ parameters.BuildArch }}
        msbuildArchitecture: ${{ parameters.msbuildArchitecture }}
        MsbuildArguments: ${{ parameters.MsbuildArguments }}
    

    